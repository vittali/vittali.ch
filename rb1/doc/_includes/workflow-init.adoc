
== Initialize the work flow

First, now that `package.json` is in place, we can finish the installation:

[listing]
$ npm install

=== Initialize the app

The first time we run the app, Node-RED will generate a credential file for `flow.json` named
`flow_cred.json`. This file contains sensitive data like the <<akat>>.
The NR-flow access code is used by Node-RED to decrypt this file.

Run the app from the project directory:

[listing]
$ ./run-app.sh

Enter the username you provided in `settings.js` and the password
you supplied to the `node-red-admin hash-pw` command,
see <<NRp>>.

Open the IBM IoT node and enter the <<akat>>. Click on _Deploy_.
This will generate the credential file `flow_cred.json`.

Populate the repo, commit and push to Bluemix:

[listing]
$ git add -A && git commit
$ git push -u origin master

Open the Delivery Pipeline of the _My-Node-RED-App_ Toolchain dashboard:

.The Delivery Pipelines shows the build-deploy process
image::stage.png[Deploy Stage]

While the build is running, log into the IBM Cloud CLI:

[listing]
$ ibmcloud login
API endpoint: https://cloud.ibm.com
Region: eu-gb
Email> <enter the email address you used to register with Bluemix>

and set the endpoint:

[listing]
$ ibmcloud target --cf

After the build has finished, check the log from with IBM Cloud CLI:

[listing]
$ ibmcloud cf logs My-Node-RED-App --recent

I advise you to check the log carefully the first time you run the app.
Note that the logs might not be available immediately after the build has finished,
this can take up to a minute.

Finally, lets check the connection between the app and the database:

[listing]
$ ibmcloud cf services
name                              service           plan                bound apps        last operation
My-IoT-Platform                   iotf-service      iotf-service-free                     create succeeded
My-Node-RED-App-cloudantNoSQLDB   cloudantNoSQLDB   Lite                My-Node-RED-App   create succeeded

Remember that
_My-Node-RED-App-cloudantNoSQLDB_ is the service name that we provided to `manifest.yml`.
